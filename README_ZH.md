# Server Market 模组使用指南 | [English](./README.md)

## 模组简介
本模组为 Minecraft 服务器添加了完整的玩家经济与物品交易市场，支持余额转账、物品上架、全服市场搜索、系统商店，以及“实物货币”映射等功能。

## 主要指令

### 玩家基础指令
- **/money**  
  查看当前余额。

- **/mpay <玩家> <金额>**  
  向其他玩家转账。  
  示例：`/mpay Steve 100.5`

- **/mprice <价格>**  
  设置手持物品在个人店铺的出售单价。  
  示例：`/mprice 5.0`

- **/msell <数量>**  
  将手持物品补货到个人店铺。  
  示例：`/msell 32`

- **/mpull**  
  下架手持物品并取回库存。

- **/msearch <物品ID>**  
  搜索全服市场的物品。  
  示例：`/msearch minecraft:diamond`

- **/mbuy <数量> <物品ID> [卖家]**  
  购买市场物品。不指定卖家时自动匹配全服最低价并可跨多个卖家合并数量；指定卖家时只会从该卖家购买（系统商店可用 `server`，或填写卖家名）。  
  示例：  
  - `/mbuy 3 minecraft:emerald` （自动最低价）  
  - `/mbuy 5 minecraft:diamond server` （只买系统商店）  
  - `/mbuy 2 minecraft:iron_ingot Steve` （指定某玩家 UUID）  
  说明：  
  - 系统商品可能设置了“单玩家每日限购”（参见 /aprice）。  
  - 当有多个上架源时，会按价格从低到高依次填满需求。

- **/mlist [玩家|server]**  
  查看指定玩家或系统商店的上架清单。  
  示例：`/mlist Steve` 或 `/mlist server`

- **/mcash <面值> <数量>**  
  将余额兑换为“实物货币”道具（由管理员通过 /acash 预先配置）。  
  示例：`/mcash 10 5`  
  注意：
  - 面值需已由管理员通过 `/acash` 配置。
  - 需要足够余额；发放时会按物品最大堆叠数分堆。
  - 若映射带有自定义 NBT（CUSTOM_DATA），会同步应用到发放物品。

- **/mexchange <数量>**  
  将主手及背包中同签名（物品ID + CUSTOM_DATA）的“实物货币”兑换回余额。  
  示例：`/mexchange 16`  
  注意：  
  - 请将要兑换的现金物品拿在主手；数量会在背包中所有同签名堆叠间合并计算。

- **/mmenu**  
  打开交互式“市场菜单”GUI。通过界面浏览卖家与商品并直接购买：  
  功能概览：  
  - 首页：显示当前余额与进入卖家列表按钮。  
  - 卖家列表：展示所有玩家卖家及系统商店（SERVER），点击头像进入其店铺；支持分页。  
  - 店铺界面：列出该卖家全部上架；左键购买 1 个，右键快速购买一组（最多 64，受库存及每日购买限制）。  
  导航提示：  
  - 箭头(ARROW)：翻页  
  - 书(BOOK)：帮助说明  
  - 箱子(CHEST)：从首页进入卖家列表  
  - 下界之星(NETHER_STAR)：返回首页或上一层  
  - 屏障(BARRIER)：关闭菜单  
  提示：系统商品若设置每日限购，右键批量购买会自动裁剪到剩余额度。

### 管理员指令（OP 等级 4）
- **/mset <玩家> <金额>**  
  设置玩家余额。  
  示例：`/mset Steve 1000.0`

- **/aprice <价格> [limitPerDay]**  
  为手持物品设置系统商店价格，并可选设置“每位玩家每日购买上限”。省略或填写 -1 表示不限制每日购买（库存本身仍为无限）。  
  示例：  
  - `/aprice 8.5` （无每日限购）  
  - `/aprice 12.0 32` （每个玩家每天最多购买 32 个）  
  说明：  
  - limitPerDay 以服务器本地“自然日”统计（日期变化重置）。  
  - 再次执行可同时修改价格与限购。  
  - 若物品之前未加入系统商店，会自动添加。

- **/apull**  
  将手持物品从系统商店下架。

- **/mlang <语言>**  
  切换系统语言。  
  示例：`/mlang en` 或 `/mlang zh`

- **/acash <面值>**  
  将手持物品标记为“实物货币”并设置面值（支持简写）。  
  示例：`/acash 10.0`

- **/acash get**  
  查看手持物品已设置的面值。

- **/acash del**  
  删除手持物品的面值映射。

- **/acash list [物品ID]**  
  列出全部“实物货币”映射，可按物品ID过滤。  
  示例：`/acash list minecraft:diamond`

- **/mreload**  
  重新加载配置（若配置中包含语言设置亦会生效）。

## 交易系统特性
1. 双市场  
   - 玩家市场：玩家自主定价，库存有限。  
   - 系统商店：管理员配置，无限库存（可选单玩家每日限购）。

2. 交易流程  
   - 自动匹配最低价。  
   - 支持跨多个卖家的库存合并。  
   - 支持指定卖家精确购买。  
   - 图形化菜单（/mmenu）可视化浏览与快速购买。

## 高级：实物货币（管理员）与玩家兑换
- 识别规则：以“物品ID + NBT（CUSTOM_DATA）”作为唯一签名；若无 NBT，则仅按物品ID 识别。
- 管理员工作流：使用 `/acash` 设置/查看/删除/列出货币映射。
- 玩家工作流：
  - 使用 `/mcash` 将余额兑换为“实物货币”。
  - 使用 `/mexchange` 将“实物货币”兑换回余额。
- 安全提示：优先选择带有独特自定义数据的物品作为“实物货币”，降低仿制风险。
